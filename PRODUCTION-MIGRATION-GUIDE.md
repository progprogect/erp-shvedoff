# üöÄ –ò–ù–°–¢–†–£–ö–¶–ò–Ø –ü–û –ú–ò–ì–†–ê–¶–ò–ò –ù–ê PRODUCTION

## ‚ö†Ô∏è –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û!

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –∫–æ–¥–∞ **–û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û** –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î, –∏–Ω–∞—á–µ —Å–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è!

## üìã –ü–û–°–õ–ï–î–û–í–ê–¢–ï–õ–¨–ù–û–°–¢–¨ –í–´–ü–û–õ–ù–ï–ù–ò–Ø –ú–ò–ì–†–ê–¶–ò–ô

### 1. –ü–æ–¥–∫–ª—é—á–∏—Ç–µ—Å—å –∫ production –ë–î
```bash
psql -h your-db-host -U your-db-user -d erp_shvedoff
```

### 2. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —É–∫–∞–∑–∞–Ω–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ:

#### üîπ –ú–∏–≥—Ä–∞—Ü–∏—è 1: –ü–æ–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –∑–∞–∫–∞–∑–æ–≤
```sql
-- –§–∞–π–ª: backend/migrations/add_order_source.sql
-- –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û! –ë–µ–∑ —ç—Ç–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ export –∑–∞–∫–∞–∑–æ–≤ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

-- –î–æ–±–∞–≤–ª—è–µ–º enum –¥–ª—è –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –∑–∞–∫–∞–∑–æ–≤
CREATE TYPE order_source AS ENUM ('database', 'website', 'avito', 'referral', 'cold_call', 'other');

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª—è –≤ —Ç–∞–±–ª–∏—Ü—É orders
ALTER TABLE orders
ADD COLUMN source order_source DEFAULT 'database',
ADD COLUMN custom_source VARCHAR(255);

-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –ø–æ–ª–µ–π
COMMENT ON COLUMN orders.source IS '–ò—Å—Ç–æ—á–Ω–∏–∫ –∑–∞–∫–∞–∑–∞: database - –∏–∑ –±–∞–∑—ã –∫–ª–∏–µ–Ω—Ç–æ–≤, website - —Å —Å–∞–π—Ç–∞, avito - —Å –ê–≤–∏—Ç–æ, referral - –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏, cold_call - —Ö–æ–ª–æ–¥–Ω—ã–µ –∑–≤–æ–Ω–∫–∏, other - –¥—Ä—É–≥–æ–µ';
COMMENT ON COLUMN orders.custom_source IS '–û–ø–∏—Å–∞–Ω–∏–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∞ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω–æ "other"';
```

#### üîπ –ú–∏–≥—Ä–∞—Ü–∏—è 2: –ü–æ–ª–µ —Ç–∏–ø–∞ –±–æ—Ä—Ç–∞
```sql
-- –§–∞–π–ª: backend/migrations/add_border_type_field.sql
-- –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª–µ border_type –≤ —Ç–∞–±–ª–∏—Ü—É products

-- –°–æ–∑–¥–∞–µ–º enum –¥–ª—è —Ç–∏–ø–∞ –±–æ—Ä—Ç–∞
CREATE TYPE border_type AS ENUM ('with_border', 'without_border');

-- –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–ª–µ –≤ —Ç–∞–±–ª–∏—Ü—É products
ALTER TABLE products 
ADD COLUMN border_type border_type;

-- –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π
COMMENT ON COLUMN products.border_type IS '–¢–∏–ø –±–æ—Ä—Ç–∞: —Å –±–æ—Ä—Ç–æ–º –∏–ª–∏ –±–µ–∑ –±–æ—Ä—Ç–∞ (–ó–∞–¥–∞—á–∞ 7.1)';
```

#### üîπ –ú–∏–≥—Ä–∞—Ü–∏—è 3: –°–∏—Å—Ç–µ–º–∞ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–π (–µ—Å–ª–∏ –µ—â–µ –Ω–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∞)
```sql
-- –§–∞–π–ª: backend/migrations/create_permissions_and_assignments.sql
-- –°–æ–∑–¥–∞–µ—Ç —Ç–∞–±–ª–∏—Ü—ã permissions, role_permissions, user_permissions
-- ‚ö†Ô∏è –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–∞–±–ª–∏—Ü permissions –µ—â–µ –Ω–µ—Ç!

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã:
SELECT EXISTS (
   SELECT FROM information_schema.tables 
   WHERE table_name = 'permissions'
);

-- –ï—Å–ª–∏ –≤–µ—Ä–Ω—É–ª–æ false, –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª–Ω—ã–π —Å–∫—Ä–∏–ø—Ç create_permissions_and_assignments.sql
```

#### üîπ –î—Ä—É–≥–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ (–µ—Å–ª–∏ –Ω—É–∂–Ω—ã)
–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏:
- `add_weight_and_grade_to_products.sql` - –≤–µ—Å –∏ —Å–æ—Ä—Ç —Ç–æ–≤–∞—Ä–æ–≤
- `add_production_calendar_fields.sql` - –ø–æ–ª—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ
- `add_production_tasks_user_fields.sql` - –ø–æ–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –∑–∞–¥–∞–Ω–∏—è—Ö
- `update_production_tasks_schema.sql` - –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—Ö–µ–º—ã –∑–∞–¥–∞–Ω–∏–π

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π

```sql
-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –ø–æ–ª—è –¥–æ–±–∞–≤–ª–µ–Ω—ã
\d orders
\d products  
\d permissions

-- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ enum'—ã —Å–æ–∑–¥–∞–Ω—ã
\dT order_source
\dT border_type
```

## üîÑ –ü–ï–†–ï–ó–ê–ü–£–°–ö –°–ï–†–í–ò–°–û–í

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π:

1. **–ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç–µ backend**:
   ```bash
   pm2 restart erp-backend
   # –∏–ª–∏
   systemctl restart erp-backend
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏**:
   ```bash
   pm2 logs erp-backend
   ```

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ health check**:
   ```bash
   curl http://localhost:5001/health
   ```

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–û–°–ü–û–°–û–ë–ù–û–°–¢–ò

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç** - –≤–æ–π–¥–∏—Ç–µ –∫–∞–∫ director/123456
2. **–†–∞–∑–¥–µ–ª—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è** - –ö–∞—Ç–∞–ª–æ–≥, –ó–∞–∫–∞–∑—ã, –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–æ, –†–∞–∑—Ä–µ—à–µ–Ω–∏—è
3. **–≠–∫—Å–ø–æ—Ä—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç** - –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–∞—Ç–∞–ª–æ–≥
4. **–ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è** - –ø—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–æ—Å–º–æ—Ç—Ä –¥–µ—Ç–∞–ª–µ–π –∏ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

## üö® –í –°–õ–£–ß–ê–ï –ü–†–û–ë–õ–ï–ú

–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend**:
   ```bash
   pm2 logs erp-backend --lines 100
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**:
   ```bash
   psql -h your-db-host -U your-db-user -d erp_shvedoff -c "SELECT version();"
   ```

3. **–û—Ç–∫–∞—Ç–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ**:
   ```sql
   DROP COLUMN IF EXISTS orders.source;
   DROP COLUMN IF EXISTS orders.custom_source;
   DROP TYPE IF EXISTS order_source;
   ```

## üìû –ö–û–ù–¢–ê–ö–¢–´

–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º —Å –º–∏–≥—Ä–∞—Ü–∏–µ–π –æ–±—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫—É.

---

**‚ö†Ô∏è –í–ê–ñ–ù–û**: –ù–µ –∑–∞–ø—É—Å–∫–∞–π—Ç–µ production –±–µ–∑ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –º–∏–≥—Ä–∞—Ü–∏–π!