# üì¶ –ë–≠–ö–ê–ü–´ –ò –ú–ò–ì–†–ê–¶–ò–ò PRODUCTION –ë–î

**–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:** 23.10.2025  
**–¶–µ–ª—å:** –ú–∏–≥—Ä–∞—Ü–∏—è Liberty Grade –Ω–∞ Production

---

## üìÅ –°–û–î–ï–†–ñ–ò–ú–û–ï –ü–ê–ü–ö–ò

### üîê **–ë–≠–ö–ê–ü–´ (—É–∂–µ —Å–æ–∑–¥–∞–Ω—ã)**

1. **–í PRODUCTION –ë–î (—Ç–∞–±–ª–∏—Ü—ã):**
   - `cutting_operations_backup_20251023` - 7 –∑–∞–ø–∏—Å–µ–π
   - `cutting_progress_log_backup_20251023` - 3 –∑–∞–ø–∏—Å–∏
   - `production_tasks_backup_20251023` - 23 –∑–∞–ø–∏—Å–∏
   - `products_grades_backup_20251023` - 14 –∑–∞–ø–∏—Å–µ–π
   - `stock_grades_backup_20251023` - 14 –∑–∞–ø–∏—Å–µ–π

2. **–ê–Ω–∞–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã:**
   - `production_analysis_20251023_125147.txt` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ PRODUCTION –ë–î
   - `staging_analysis_*.txt` - —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ STAGING –ë–î

### üìù **–ú–ò–ì–†–ê–¶–ò–û–ù–ù–´–ï –°–ö–†–ò–ü–¢–´**

#### **–û—Å–Ω–æ–≤–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏:**
1. `01_add_liberty_grade_fields.sql` - –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è Liberty –≤ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∑–∫–∏
2. `02_add_production_grades_fields.sql` - –î–æ–±–∞–≤–ª—è–µ—Ç –ø–æ–ª—è —Å–æ—Ä—Ç–æ–≤ –≤ production_tasks
3. `03_update_cutting_progress_trigger.sql` - –û–±–Ω–æ–≤–ª—è–µ—Ç —Ç—Ä–∏–≥–≥–µ—Ä –¥–ª—è Liberty

#### **–í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Å–∫—Ä–∏–ø—Ç—ã:**
- `RUN_MIGRATION.sql` - **–ì–õ–ê–í–ù–´–ô –°–ö–†–ò–ü–¢** - –∑–∞–ø—É—Å–∫–∞–µ—Ç –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
- `04_verify_migration.sql` - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
- `ROLLBACK.sql` - –û—Ç–∫–∞—Ç—ã–≤–∞–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é –≤ —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º

#### **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `MIGRATION_PLAN.md` - **–ü–æ–¥—Ä–æ–±–Ω—ã–π –ø–ª–∞–Ω –º–∏–≥—Ä–∞—Ü–∏–∏**
- `README.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª

---

## üöÄ –ö–ê–ö –í–´–ü–û–õ–ù–ò–¢–¨ –ú–ò–ì–†–ê–¶–ò–Æ

### **–í–ê–†–ò–ê–ù–¢ 1: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)**

```bash
# 1. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –ø–∞–ø–∫—É backups
cd /Users/mikitavalkunovich/Desktop/Cursor/ERP-New/backups

# 2. –ó–∞–ø—É—Å—Ç–∏—Ç–µ –≥–ª–∞–≤–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –º–∏–≥—Ä–∞—Ü–∏–∏
PGPASSWORD=xeIitZntkaAAeoZSFpsOsfCOKpoORwGA psql \
  -h yamanote.proxy.rlwy.net \
  -p 41401 \
  -U postgres \
  -d railway \
  -f RUN_MIGRATION.sql
```

–≠—Ç–æ—Ç —Å–∫—Ä–∏–ø—Ç:
- –ü–æ–∫–∞–∂–µ—Ç –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –º–∏–≥—Ä–∞—Ü–∏–∏
- –ü–æ–ø—Ä–æ—Å–∏—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- –í—ã–ø–æ–ª–Ω–∏—Ç –≤—Å–µ 3 –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ
- –ü—Ä–æ–≤–µ—Ä–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç

---

### **–í–ê–†–ò–ê–ù–¢ 2: –ü–æ—à–∞–≥–æ–≤—ã–π (–¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—è)**

```bash
cd /Users/mikitavalkunovich/Desktop/Cursor/ERP-New/backups

# –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è Liberty –≤ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∑–∫–∏
PGPASSWORD=xeIitZntkaAAeoZSFpsOsfCOKpoORwGA psql \
  -h yamanote.proxy.rlwy.net -p 41401 -U postgres -d railway \
  -f 01_add_liberty_grade_fields.sql

# –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª—è —Å–æ—Ä—Ç–æ–≤ –≤ production_tasks
PGPASSWORD=xeIitZntkaAAeoZSFpsOsfCOKpoORwGA psql \
  -h yamanote.proxy.rlwy.net -p 41401 -U postgres -d railway \
  -f 02_add_production_grades_fields.sql

# –®–∞–≥ 3: –û–±–Ω–æ–≤–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä
PGPASSWORD=xeIitZntkaAAeoZSFpsOsfCOKpoORwGA psql \
  -h yamanote.proxy.rlwy.net -p 41401 -U postgres -d railway \
  -f 03_update_cutting_progress_trigger.sql

# –®–∞–≥ 4: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç
PGPASSWORD=xeIitZntkaAAeoZSFpsOsfCOKpoORwGA psql \
  -h yamanote.proxy.rlwy.net -p 41401 -U postgres -d railway \
  -f 04_verify_migration.sql
```

---

## üîô –ö–ê–ö –û–¢–ö–ê–¢–ò–¢–¨ –ú–ò–ì–†–ê–¶–ò–Æ

**–í —Å–ª—É—á–∞–µ –ø—Ä–æ–±–ª–µ–º:**

```bash
cd /Users/mikitavalkunovich/Desktop/Cursor/ERP-New/backups

PGPASSWORD=xeIitZntkaAAeoZSFpsOsfCOKpoORwGA psql \
  -h yamanote.proxy.rlwy.net -p 41401 -U postgres -d railway \
  -f ROLLBACK.sql
```

‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –ü–æ—Å–ª–µ –æ—Ç–∫–∞—Ç–∞ —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ –æ—Ç–∫–∞—Ç–∏—Ç—å backend –∏ frontend!

---

## ‚úÖ –ö–†–ò–¢–ï–†–ò–ò –£–°–ü–ï–•–ê

–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:

1. ‚úÖ –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ Liberty –¥–æ–±–∞–≤–ª–µ–Ω—ã
2. ‚úÖ –í—Å–µ –∫–æ–ª–æ–Ω–∫–∏ —Å–æ—Ä—Ç–æ–≤ –≤ production_tasks –¥–æ–±–∞–≤–ª–µ–Ω—ã
3. ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –æ–±–Ω–æ–≤–ª–µ–Ω (has_liberty_support = –î–ê)
4. ‚úÖ –¢—Ä–∏–≥–≥–µ—Ä –∏–º–µ–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –ª–æ–≥–∏–∫—É (has_correct_logic = –î–ê)
5. ‚úÖ –í—Å–µ –±—ç–∫–∞–ø—ã –Ω–∞ –º–µ—Å—Ç–µ
6. ‚úÖ –°—É—â–µ—Å—Ç–≤—É—é—â–∏–µ –¥–∞–Ω–Ω—ã–µ –Ω–µ –ø–æ–≤—Ä–µ–∂–¥–µ–Ω—ã

---

## üìä –°–¢–ê–¢–ò–°–¢–ò–ö–ê –ò–ó–ú–ï–ù–ï–ù–ò–ô

### **–ß—Ç–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ:**

#### `cutting_operations`
- `actual_liberty_grade_quantity` INTEGER DEFAULT 0

#### `cutting_progress_log`
- `liberty_grade_quantity` INTEGER DEFAULT 0

#### `production_tasks`
- `second_grade_quantity` INTEGER DEFAULT 0
- `liberty_grade_quantity` INTEGER DEFAULT 0

#### –¢—Ä–∏–≥–≥–µ—Ä `update_stock_from_cutting_progress`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Liberty Grade
- –£–¥–∞–ª–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏
- –¢—Ä–∏–≥–≥–µ—Ä —Ç–µ–ø–µ—Ä—å —Ç–æ–ª—å–∫–æ –æ–±–Ω–æ–≤–ª—è–µ—Ç stock

---

## üîç –ü–†–û–í–ï–†–ö–ê –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò

### **1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ë–î:**

```sql
SELECT column_name, data_type 
FROM information_schema.columns 
WHERE table_name IN ('cutting_operations', 'cutting_progress_log', 'production_tasks')
  AND (column_name LIKE '%liberty%' OR column_name LIKE '%grade%')
ORDER BY table_name, column_name;
```

### **2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä:**

```sql
SELECT proname, 
       CASE WHEN prosrc LIKE '%_liberty_grade_diff%' THEN '–î–ê' ELSE '–ù–ï–¢' END as has_liberty
FROM pg_proc 
WHERE proname = 'update_stock_from_cutting_progress';
```

### **3. –¢–µ—Å—Ç–æ–≤—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏:**

–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è backend:
1. –°–æ–∑–¥–∞–π—Ç–µ –æ–ø–µ—Ä–∞—Ü–∏—é —Ä–µ–∑–∫–∏
2. –î–æ–±–∞–≤—å—Ç–µ –ø—Ä–æ–≥—Ä–µ—Å—Å —Å Liberty
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–≤–∞—Ä Liberty —Å–æ–∑–¥–∞–ª—Å—è —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º –∞—Ä—Ç–∏–∫—É–ª–æ–º
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –æ—Å—Ç–∞—Ç–∫–∏ –æ–±–Ω–æ–≤–∏–ª–∏—Å—å

---

## üéØ –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò –ü–û–°–õ–ï –ú–ò–ì–†–ê–¶–ò–ò

1. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å backend:**
   ```bash
   git push origin stage
   # Railway –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç
   ```

2. **–ó–∞–¥–µ–ø–ª–æ–∏—Ç—å frontend:**
   - Frontend —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –Ω–∞ staging
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ UI –¥–ª—è Liberty –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è

3. **–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å:**
   - –û–ø–µ—Ä–∞—Ü–∏–∏ —Ä–µ–∑–∫–∏ —Å Liberty
   - –ü—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–∞–¥–∞–Ω–∏—è —Å —Å–æ—Ä—Ç–∞–º–∏
   - –ú–∞—Å—Å–æ–≤—É—é —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—é
   - –û—Å—Ç–∞—Ç–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤

4. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ Railway
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –æ—à–∏–±–æ–∫
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±—Ä–∞–∫ –ù–ï –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –≤ –æ—Å—Ç–∞—Ç–∫–∏

---

## üìû –í –°–õ–£–ß–ê–ï –ü–†–û–ë–õ–ï–ú

1. **–ù–µ–º–µ–¥–ª–µ–Ω–Ω–æ:**
   - –ó–∞–ø—É—Å—Ç–∏—Ç—å `ROLLBACK.sql`
   - –û—Ç–∫–∞—Ç–∏—Ç—å backend –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â—É—é –≤–µ—Ä—Å–∏—é
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏

2. **–ê–Ω–∞–ª–∏–∑:**
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å `MIGRATION_PLAN.md`
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±—ç–∫–∞–ø—ã
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –º–∏–≥—Ä–∞—Ü–∏–∏

3. **–í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ:**
   - –î–∞–Ω–Ω—ã–µ –≤ –±—ç–∫–∞–ø–∞—Ö: `*_backup_20251023`
   - –ú–æ–∂–Ω–æ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—Ä—É—á–Ω—É—é

---

## ‚ö†Ô∏è –í–ê–ñ–ù–û

1. **–ù–ï –£–î–ê–õ–Ø–¢–¨** –±—ç–∫–∞–ø—ã –º–∏–Ω–∏–º—É–º 7 –¥–Ω–µ–π
2. **–ü–†–û–í–ï–†–ò–¢–¨** —Ä–∞–±–æ—Ç—É –Ω–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–æ–º
3. **–ò–ú–ï–¢–¨** –ø–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞
4. **–ú–û–ù–ò–¢–û–†–ò–¢–¨** —Å–∏—Å—Ç–µ–º—É –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

---

## üìà –í–ï–†–°–ò–û–ù–ù–û–°–¢–¨

- **–î–æ –º–∏–≥—Ä–∞—Ü–∏–∏:** –ù–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ Liberty, —Ç–æ–≤–∞—Ä—ã 2-–≥–æ —Å–æ—Ä—Ç–∞ —Å –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –∞—Ä—Ç–∏–∫—É–ª–∞–º–∏
- **–ü–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:** –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Liberty, –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –∞—Ä—Ç–∏–∫—É–ª—ã, –±—Ä–∞–∫ –Ω–µ –≤ –æ—Å—Ç–∞—Ç–∫–∞—Ö

---

**–ì–û–¢–û–í–û –ö –ú–ò–ì–†–ê–¶–ò–ò** ‚úÖ  
**–û–∂–∏–¥–∞–µ—Ç—Å—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è**




